# Visualizations in Python #

import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt

# Bring the fields into the visual and adjust the names below --
df = dataset[['Date', 'Sales']].rename(columns={'Date': 'ds', 'Sales': 'y'})
df['ds'] = pd.to_datetime(df['ds'])

# Aggregate values by different parameters (remove if the aggregation is not wanted) --
# M, A, Q, W and/or mean instead of sum()
monthly_df = df.resample('M', on='ds').sum().reset_index()

model = Prophet()
model.fit(montly_df)

# Adjust the periods as necessary and the date parameter
future = model.make_future_dataframe(periods=12, freq='M')

# Forecast
forecast = model.predict(future)

# Plot forecast
fig = model.plot(forecast)
plt.title("Sales Forecast with Prophet")
plt.xlabel("Date")
plt.ylabel("Sales")
plt.show()

//
//

import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.arima.model import ARIMA

dataset['Date'] = pd.to_datetime(dataset['Date'])
dataset = dataset.sort_values('Date')
dataset.set_index('Date', inplace=True)

# Adjust '24' based on periods to look back on for forecasting
model = ARIMA(dataset['Sales'], order=(24,1,1))  # (p,d,q) - try tuning these
model_fit = model.fit()

forecast = model_fit.forecast(steps=12)

plt.figure(figsize=(10,5))
plt.plot(dataset['Sales'], label='Historical')
plt.plot(forecast, label='Forecast', color='red')
plt.legend()
plt.title('Sales Forecast (ARIMA)')
plt.tight_layout()
plt.show()

//
//

# Utilize holidays #
import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt
from prophet.make_holidays import make_holidays_df

# Step 1: Bring in and prepare data
df = dataset[['Sale Date', 'Delivery Performance']].rename(columns={'Sale Date': 'ds', 'Delivery Performance': 'y'})
df['ds'] = pd.to_datetime(df['ds'])

# Step 2: Aggregate daily data into monthly average Delivery Performance
monthly_df = df.resample('W', on='ds').mean().reset_index()

# Step 3: Define known plant holidays
plant_holidays = pd.DataFrame({
    'holiday': 'plant_closed',
    'ds': pd.to_datetime([
        '2023-12-25', '2024-01-01', '2024-07-04',  # Example US holidays
        '2024-11-28', '2024-12-25', '2025-01-01'   # Add more as needed
    ]),
    'lower_window': 0,
    'upper_window': 0,
})

# Step 4: Identify Sundays from monthly data (approximate - real closure is daily)
# If you have daily data, do this instead on `df`, not `monthly_df`
sundays = df[df['ds'].dt.weekday == 6][['ds']].copy()
sundays['holiday'] = 'sunday_closure'
sundays['lower_window'] = 0
sundays['upper_window'] = 0

# Step 5: Combine all holidays
custom_holidays = pd.concat([plant_holidays, sundays])

# Optional: set a nice plot style
# plt.style.use('fivethirtyeight')

# Step 6: Fit the Prophet model with holiday effects
model = Prophet(holidays=custom_holidays)
model.fit(monthly_df)

# Step 7: Forecast 12 future monthly periods
future = model.make_future_dataframe(periods=12, freq='W')

# Step 8: Generate forecast
forecast = model.predict(future)

# Step 9: Plot forecast
fig = model.plot(forecast, include_legend=True)
# Optionally visualize changepoints
# from prophet.plot import add_changepoints_to_plot
# add_changepoints_to_plot(fig.gca(), model, forecast)
plt.title("Weekly DP Forecast with Prophet")
plt.xlabel("Date")
plt.ylabel("Weekly DP")
plt.tight_layout()
plt.show()

//
//

# Components #

import pandas as pd
from prophet import Prophet
import matplotlib.pyplot as plt

# Bring in and prepare data
df = dataset[['Sale Date', 'Delivery Performance']].rename(columns={'Sale Date': 'ds', 'Delivery Performance': 'y'})
df['ds'] = pd.to_datetime(df['ds'])

# Aggregate daily data into monthly revenue (summing values for each month)
monthly_df = df.resample('M', on='ds').mean().reset_index()

# Fit Prophet model
model = Prophet()
model.fit(monthly_df)

# Forecast future periods (12 months into the future)
future = model.make_future_dataframe(periods=12, freq='M')

# Predict
forecast = model.predict(future)

# Plot forecast
fig2 = model.plot_components(forecast)
# a = add_changepoints_to_plot(fig.gca(),
                             # model, forecast)
plt.title("Monthly DP Forecast with Prophet")
plt.xlabel("Date")
plt.ylabel("Monthly DP")
plt.tight_layout()
plt.show()
